{"remainingRequest":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/src/components/video-call/index.vue?vue&type=style&index=0&id=c5234dfa&scoped=true&lang=css&","dependencies":[{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/src/components/video-call/index.vue","mtime":1604998570000},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/css-loader/dist/cjs.js","mtime":1610420041655},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1610420042252},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/postcss-loader/src/index.js","mtime":1597388791021},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/cache-loader/dist/cjs.js","mtime":1610420035136},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/vue-loader/lib/index.js","mtime":1610420042252}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnZpZGVvLWNhbGwtc2VjdGlvbiB7CiAgcGFkZGluZy10b3A6IDUwcHg7CiAgd2lkdGg6IDgwMHB4OwogIG1hcmdpbjogMCBhdXRvOwp9Ci52aWRlby1jYWxsLXNlY3Rpb24taGVhZGVyIHsKICBmb250LXNpemU6IDI0cHg7Cn0KLnZpZGVvLWNhbGwtc2VjdGlvbi10aXRsZSB7CiAgbWFyZ2luLXRvcDogMzBweDsKICBmb250LXNpemU6IDIwcHg7Cn0KLnZpZGVvLWNvbmZlcmVuY2UgewogIGRpc3BsYXk6IG5vbmU7CiAgbWFyZ2luLXRvcDogMjBweDsKfQoudmlkZW8tY29uZmVyZW5jZS5pcy1zaG93IHsKICBkaXNwbGF5OiBibG9jazsKfQoKLnZpZGVvLWNvbmZlcmVuY2UtbGlzdCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIG1hcmdpbi10b3A6IDEwcHg7Cn0KCi51c2VyLXZpZGVvLWNvbnRhaW5lciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHRleHQtYWxpZ246IGxlZnQ7CiAgd2lkdGg6IDM2MHB4OwogIGhlaWdodDogMjQwcHg7CiAgbWFyZ2luOiAxMHB4Owp9CgoudXNlci12aWRlby1zdGF0dXMgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICByaWdodDogNTBweDsKICBib3R0b206IDIwcHg7CiAgd2lkdGg6IDI0cHg7CiAgaGVpZ2h0OiAyN3B4OwogIHotaW5kZXg6IDEwOwogIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi4vLi4vYXNzZXRzL2NhbWVyYS1vbi5wbmciKTsKICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOwp9Ci51c2VyLXZpZGVvLXN0YXR1cy5pcy1tdXRlIHsKICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4uLy4uL2Fzc2V0cy9jYW1lcmEtb2ZmLnBuZyIpOwp9CgoudXNlci1hdWRpby1zdGF0dXMgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICByaWdodDogMjBweDsKICBib3R0b206IDIwcHg7CiAgd2lkdGg6IDIycHg7CiAgaGVpZ2h0OiAyN3B4OwogIHotaW5kZXg6IDEwOwogIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi4vLi4vYXNzZXRzL21pYy1vbi5wbmciKTsKICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOwp9CgoudXNlci1hdWRpby1zdGF0dXMuaXMtbXV0ZSB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuLi8uLi9hc3NldHMvbWljLW9mZi5wbmciKTsKfQoKLnZpZGVvLWNvbmZlcmVuY2UtYWN0aW9uIHsKICBtYXJnaW4tdG9wOiAxMHB4Owp9CgoudmlkZW8taXRlbS11c2VybmFtZSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMjBweDsKICBsZWZ0OiAyMHB4OwogIHotaW5kZXg6IDEwOwogIGNvbG9yOiAjZmZmZmZmOwp9CkBtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDc2N3B4KSB7CiAgLnZpZGVvLWNhbGwtc2VjdGlvbiB7CiAgICB3aWR0aDogMTAwJTsKICB9CiAgLnZpZGVvLWNvbmZlcmVuY2UtbGlzdCB7CiAgICBtYXJnaW46IDA7CiAgICBwYWRkaW5nOiAxMHB4OwogIH0KICAudXNlci12aWRlby1jb250YWluZXIgewogICAgbWFyZ2luOiA1cHg7CiAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/video-call","sourcesContent":["<template>\n  <div class=\"video-call-section\">\n    <div\n      class=\"video-call-section-header\"\n    >Welcome {{loginUserInfo && (loginUserInfo.name || loginUserInfo.userId)}}</div>\n    <div class=\"video-call-section-title\">视频通话</div>\n    <search-user @callUser=\"handleCallUser\" @cancelCallUser=\"handleCancelCallUser\"></search-user>\n    <div :class=\"{ 'video-conference': true, 'is-show': isShowVideoCall }\">\n      <div class=\"video-conference-header\">视频通话区域</div>\n\n      <div class=\"video-conference-list\">\n        <div\n          v-for=\"userId in meetingUserIdList\"\n          :key=\"`video-${userId}`\"\n          :id=\"`video-${userId}`\"\n          :class=\"{'user-video-container': true, 'is-me': userId === loginUserInfo.userId}\"\n        >\n          <div class=\"user-status\">\n            <div\n              :class=\"{'user-video-status': true, 'is-mute': isUserMute(muteVideoUserIdList, userId)}\"\n            ></div>\n            <div\n              :class=\"{'user-audio-status': true, 'is-mute': isUserMute(muteAudioUserIdList, userId)}\"\n            ></div>\n          </div>\n          <div class=\"video-item-username\">{{userId2Name[userId] || userId}}</div>\n        </div>\n      </div>\n      <div class=\"video-conference-action\">\n        <el-button\n          class=\"action-btn\"\n          type=\"success\"\n          @click=\"toggleVideo\"\n        >{{isVideoOn ? '关闭摄像头' : '打开摄像头'}}</el-button>\n\n        <el-button\n          class=\"action-btn\"\n          type=\"success\"\n          @click=\"toggleAudio\"\n        >{{isAudioOn ? '关闭麦克风' : '打开麦克风'}}</el-button>\n\n        <el-button class=\"action-btn\" type=\"danger\" @click=\"handleHangup\">挂断</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\";\nimport SearchUser from \"../search-user\";\nimport { getUsernameByUserid } from \"../../service\";\nimport config from \"../../config\";\nexport default {\n  name: \"VideoCall\",\n  components: {\n    SearchUser\n  },\n  computed: {\n    ...mapState({\n      loginUserInfo: state => state.loginUserInfo,\n      callStatus: state => state.callStatus,\n      isInviter: state => state.isInviter,\n      meetingUserIdList: state => state.meetingUserIdList,\n      muteVideoUserIdList: state => state.muteVideoUserIdList,\n      muteAudioUserIdList: state => state.muteAudioUserIdList\n    })\n  },\n  data() {\n    return {\n      isShowVideoCall: false,\n      isVideoOn: true,\n      isAudioOn: true,\n      userId2Name: {}\n    };\n  },\n  mounted() {\n    if (this.callStatus === \"connected\" && !this.isInviter) {\n      this.startMeeting();\n      this.updateUserId2Name(this.meetingUserIdList);\n    }\n  },\n  destroyed() {\n    this.$store.commit(\"updateMuteVideoUserIdList\", []);\n    this.$store.commit(\"updateMuteAudioUserIdList\", []);\n    if (this.callStatus === \"connected\") {\n      this.$trtcCalling.hangup();\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n    }\n  },\n  watch: {\n    callStatus: function(newStatus, oldStatus) {\n      // 作为被邀请者, 建立通话连接\n      if (newStatus !== oldStatus && newStatus === \"connected\") {\n        this.startMeeting();\n        this.updateUserId2Name(this.meetingUserIdList);\n      }\n    },\n    meetingUserIdList: function(newList, oldList) {\n      if (newList !== oldList || newList.length !== oldList) {\n        this.updateUserId2Name(newList);\n      }\n    }\n  },\n  methods: {\n    handleCallUser: function({ param }) {\n      // 可设置超时\n      this.$trtcCalling.call({\n        userID: param,\n        type: this.TrtcCalling.CALL_TYPE.VIDEO_CALL,\n        timeout: config.CallTimeout\n      });\n      this.$store.commit(\"userJoinMeeting\", this.loginUserInfo.userId);\n      this.$store.commit(\"updateCallStatus\", \"calling\");\n      this.$store.commit(\"updateIsInviter\", true);\n    },\n    handleCancelCallUser: function() {\n      this.$trtcCalling.hangup();\n      this.$store.commit(\"dissolveMeeting\");\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n    },\n    startMeeting: function() {\n      if (this.meetingUserIdList.length >= 3) {\n        // 多人通话\n        const lastJoinUser = this.meetingUserIdList[\n          this.meetingUserIdList.length - 1\n        ];\n        this.$trtcCalling.startRemoteView({\n          userID: lastJoinUser,\n          videoViewDomID: `video-${lastJoinUser}`\n        });\n        return;\n      }\n      this.isShowVideoCall = true;\n      this.$trtcCalling.startLocalView({\n        userID: this.loginUserInfo.userId,\n        videoViewDomID: `video-${this.loginUserInfo.userId}`\n      });\n      const otherParticipants = this.meetingUserIdList.filter(\n        userId => userId !== this.loginUserInfo.userId\n      );\n      otherParticipants.forEach(userId => {\n        this.$trtcCalling.startRemoteView({\n          userID: userId,\n          videoViewDomID: `video-${userId}`\n        });\n      });\n    },\n    handleHangup: function() {\n      this.$trtcCalling.hangup();\n      this.isShowVideoCall = false;\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n      this.$router.push(\"/\");\n    },\n    toggleVideo: function() {\n      this.isVideoOn = !this.isVideoOn;\n      if (this.isVideoOn) {\n        this.$trtcCalling.openCamera();\n        const muteUserList = this.muteVideoUserIdList.filter(\n          userId => userId !== this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteVideoUserIdList\", muteUserList);\n      } else {\n        this.$trtcCalling.closeCamera();\n        const muteUserList = this.muteVideoUserIdList.concat(\n          this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteVideoUserIdList\", muteUserList);\n      }\n    },\n    toggleAudio: function() {\n      this.isAudioOn = !this.isAudioOn;\n      this.$trtcCalling.setMicMute(!this.isAudioOn);\n      if (this.isAudioOn) {\n        const muteUserList = this.muteAudioUserIdList.filter(\n          userId => userId !== this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteAudioUserIdList\", muteUserList);\n      } else {\n        const muteUserList = this.muteAudioUserIdList.concat(\n          this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteAudioUserIdList\", muteUserList);\n      }\n    },\n    isUserMute: function(muteUserList, userId) {\n      return muteUserList.indexOf(userId) !== -1;\n    },\n    updateUserId2Name: async function(userIdList) {\n      let userId2Name = {};\n      let loginUserId = this.loginUserInfo.userId;\n      for (let i = 0; i < userIdList.length; i++) {\n        const userId = userIdList[i];\n        if (!this.userId2Name[userId]) {\n          const userName = await getUsernameByUserid(userId);\n          userId2Name[userId] = userName;\n          if (loginUserId === userId) {\n            userId2Name[userId] += \"(me)\";\n          }\n        }\n      }\n      this.userId2Name = {\n        ...this.userId2Name,\n        ...userId2Name\n      };\n    },\n    goto: function(path) {\n      this.$router.push(path);\n    }\n  }\n};\n</script>\n\n<style scoped>\n.video-call-section {\n  padding-top: 50px;\n  width: 800px;\n  margin: 0 auto;\n}\n.video-call-section-header {\n  font-size: 24px;\n}\n.video-call-section-title {\n  margin-top: 30px;\n  font-size: 20px;\n}\n.video-conference {\n  display: none;\n  margin-top: 20px;\n}\n.video-conference.is-show {\n  display: block;\n}\n\n.video-conference-list {\n  display: flex;\n  flex-direction: row;\n  margin-top: 10px;\n}\n\n.user-video-container {\n  position: relative;\n  text-align: left;\n  width: 360px;\n  height: 240px;\n  margin: 10px;\n}\n\n.user-video-status {\n  position: absolute;\n  right: 50px;\n  bottom: 20px;\n  width: 24px;\n  height: 27px;\n  z-index: 10;\n  background-image: url(\"../../assets/camera-on.png\");\n  background-size: cover;\n}\n.user-video-status.is-mute {\n  background-image: url(\"../../assets/camera-off.png\");\n}\n\n.user-audio-status {\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n  width: 22px;\n  height: 27px;\n  z-index: 10;\n  background-image: url(\"../../assets/mic-on.png\");\n  background-size: cover;\n}\n\n.user-audio-status.is-mute {\n  background-image: url(\"../../assets/mic-off.png\");\n}\n\n.video-conference-action {\n  margin-top: 10px;\n}\n\n.video-item-username {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  z-index: 10;\n  color: #ffffff;\n}\n@media screen and (max-width: 767px) {\n  .video-call-section {\n    width: 100%;\n  }\n  .video-conference-list {\n    margin: 0;\n    padding: 10px;\n  }\n  .user-video-container {\n    margin: 5px;\n  }\n}\n</style>\n"]}]}