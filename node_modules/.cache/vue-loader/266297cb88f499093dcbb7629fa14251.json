{"remainingRequest":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/src/components/audio-call/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/src/components/audio-call/index.vue","mtime":1604998570000},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/cache-loader/dist/cjs.js","mtime":1610420035136},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/babel-loader/lib/index.js","mtime":1607423996145},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/cache-loader/dist/cjs.js","mtime":1610420035136},{"path":"/Users/xuzhitao/Desktop/Web/TRTCScenesDemo/trtc-calling-web/node_modules/vue-loader/lib/index.js","mtime":1610420042252}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAidnVleCI7CmltcG9ydCBTZWFyY2hVc2VyIGZyb20gIi4uL3NlYXJjaC11c2VyIjsKaW1wb3J0IHsgZ2V0VXNlckRldGFpbEluZm9CeVVzZXJpZCB9IGZyb20gIi4uLy4uL3NlcnZpY2UiOwppbXBvcnQgY29uZmlnIGZyb20gIi4uLy4uL2NvbmZpZyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkF1ZGlvQ2FsbCIsCiAgY29tcG9uZW50czogewogICAgU2VhcmNoVXNlcgogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKHsKICAgICAgbG9naW5Vc2VySW5mbzogc3RhdGUgPT4gc3RhdGUubG9naW5Vc2VySW5mbywKICAgICAgY2FsbFN0YXR1czogc3RhdGUgPT4gc3RhdGUuY2FsbFN0YXR1cywKICAgICAgaXNJbnZpdGVyOiBzdGF0ZSA9PiBzdGF0ZS5pc0ludml0ZXIsCiAgICAgIG1lZXRpbmdVc2VySWRMaXN0OiBzdGF0ZSA9PiBzdGF0ZS5tZWV0aW5nVXNlcklkTGlzdCwKICAgICAgbXV0ZUF1ZGlvVXNlcklkTGlzdDogc3RhdGUgPT4gc3RhdGUubXV0ZUF1ZGlvVXNlcklkTGlzdAogICAgfSkKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpc1Nob3dBdWRpb0NhbGw6IGZhbHNlLAogICAgICBpc0F1ZGlvT246IHRydWUsCiAgICAgIHVzZXJJZDJVc2VyOiB7fQogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICBpZiAodGhpcy5jYWxsU3RhdHVzID09PSAiY29ubmVjdGVkIiAmJiAhdGhpcy5pc0ludml0ZXIpIHsKICAgICAgdGhpcy5zdGFydE1lZXRpbmcoKTsKICAgICAgdGhpcy51cGRhdGVVc2VySWQyVXNlckluZm8odGhpcy5tZWV0aW5nVXNlcklkTGlzdCk7CiAgICB9CiAgfSwKICBkZXN0cm95ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZU11dGVWaWRlb1VzZXJJZExpc3QiLCBbXSk7CiAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZU11dGVBdWRpb1VzZXJJZExpc3QiLCBbXSk7CiAgICBpZiAodGhpcy5jYWxsU3RhdHVzID09PSAiY29ubmVjdGVkIikgewogICAgICB0aGlzLiR0cnRjQ2FsbGluZy5oYW5ndXAoKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJ1cGRhdGVDYWxsU3RhdHVzIiwgImlkbGUiKTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBjYWxsU3RhdHVzOiBmdW5jdGlvbihuZXdTdGF0dXMsIG9sZFN0YXR1cykgewogICAgICAvLyDlu7rnq4vpgJror53ov57mjqUKICAgICAgaWYgKG5ld1N0YXR1cyAhPT0gb2xkU3RhdHVzICYmIG5ld1N0YXR1cyA9PT0gImNvbm5lY3RlZCIpIHsKICAgICAgICB0aGlzLnN0YXJ0TWVldGluZygpOwogICAgICAgIHRoaXMudXBkYXRlVXNlcklkMlVzZXJJbmZvKHRoaXMubWVldGluZ1VzZXJJZExpc3QpOwogICAgICB9CiAgICB9LAogICAgbWVldGluZ1VzZXJJZExpc3Q6IGZ1bmN0aW9uKG5ld0xpc3QsIG9sZExpc3QpIHsKICAgICAgaWYgKG5ld0xpc3QgIT09IG9sZExpc3QgfHwgbmV3TGlzdC5sZW5ndGggIT09IG9sZExpc3QubGVuZ3RoKSB7CiAgICAgICAgdGhpcy51cGRhdGVVc2VySWQyVXNlckluZm8obmV3TGlzdCk7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGhhbmRsZUNhbGxVc2VyOiBmdW5jdGlvbih7IHBhcmFtIH0pIHsKICAgICAgaWYgKCFwYXJhbSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivt+i+k+WFpeaLqOWPq+WPt+eggSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLiR0cnRjQ2FsbGluZy5jYWxsKHsKICAgICAgICB1c2VySUQ6IHBhcmFtLAogICAgICAgIHR5cGU6IHRoaXMuVHJ0Y0NhbGxpbmcuQ0FMTF9UWVBFLkFVRElPX0NBTEwsCiAgICAgICAgdGltZW91dDogY29uZmlnLkNhbGxUaW1lb3V0CiAgICAgIH0pOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVzZXJKb2luTWVldGluZyIsIHRoaXMubG9naW5Vc2VySW5mby51c2VySWQpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZUNhbGxTdGF0dXMiLCAiY2FsbGluZyIpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZUlzSW52aXRlciIsIHRydWUpOwogICAgfSwKICAgIGhhbmRsZUNhbmNlbENhbGxVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kdHJ0Y0NhbGxpbmcuaGFuZ3VwKCk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgiZGlzc29sdmVNZWV0aW5nIik7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgidXBkYXRlQ2FsbFN0YXR1cyIsICJpZGxlIik7CiAgICB9LAogICAgdG9nZ2xlQXVkaW86IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlzQXVkaW9PbiA9ICF0aGlzLmlzQXVkaW9PbjsKICAgICAgdGhpcy4kdHJ0Y0NhbGxpbmcuc2V0TWljTXV0ZSghdGhpcy5pc0F1ZGlvT24pOwogICAgICBpZiAodGhpcy5pc0F1ZGlvT24pIHsKICAgICAgICBjb25zdCBtdXRlVXNlckxpc3QgPSB0aGlzLm11dGVBdWRpb1VzZXJJZExpc3QuZmlsdGVyKAogICAgICAgICAgdXNlcklkID0+IHVzZXJJZCAhPT0gdGhpcy5sb2dpblVzZXJJbmZvLnVzZXJJZAogICAgICAgICk7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJ1cGRhdGVNdXRlQXVkaW9Vc2VySWRMaXN0IiwgbXV0ZVVzZXJMaXN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBtdXRlVXNlckxpc3QgPSB0aGlzLm11dGVBdWRpb1VzZXJJZExpc3QuY29uY2F0KAogICAgICAgICAgdGhpcy5sb2dpblVzZXJJbmZvLnVzZXJJZAogICAgICAgICk7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJ1cGRhdGVNdXRlQXVkaW9Vc2VySWRMaXN0IiwgbXV0ZVVzZXJMaXN0KTsKICAgICAgfQogICAgfSwKICAgIGhhbmRsZUhhbmd1cDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJHRydGNDYWxsaW5nLmhhbmd1cCgpOwogICAgICB0aGlzLmlzU2hvd1ZpZGVvQ2FsbCA9IGZhbHNlOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZUNhbGxTdGF0dXMiLCAiaWRsZSIpOwogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgiLyIpOwogICAgfSwKICAgIGlzVXNlck11dGU6IGZ1bmN0aW9uKG11dGVVc2VyTGlzdCwgdXNlcklkKSB7CiAgICAgIHJldHVybiBtdXRlVXNlckxpc3QuaW5kZXhPZih1c2VySWQpICE9PSAtMTsKICAgIH0sCiAgICBzdGFydE1lZXRpbmc6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlzU2hvd0F1ZGlvQ2FsbCA9IHRydWU7CiAgICB9LAogICAgdXBkYXRlVXNlcklkMlVzZXJJbmZvOiBhc3luYyBmdW5jdGlvbih1c2VySWRMaXN0KSB7CiAgICAgIGxldCB1c2VySWQyVXNlckluZm8gPSB7fTsKICAgICAgbGV0IGxvZ2luVXNlcklkID0gdGhpcy5sb2dpblVzZXJJbmZvLnVzZXJJZDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VySWRMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlcklkTGlzdFtpXTsKICAgICAgICBjb25zdCB1c2VySW5mbyA9IGF3YWl0IGdldFVzZXJEZXRhaWxJbmZvQnlVc2VyaWQodXNlcklkKTsKICAgICAgICB1c2VySWQyVXNlckluZm9bdXNlcklkXSA9IHVzZXJJbmZvOwogICAgICAgIGlmIChsb2dpblVzZXJJZCA9PT0gdXNlcklkKSB7CiAgICAgICAgICB1c2VySWQyVXNlckluZm9bdXNlcklkXS5uYW1lICs9ICIobWUpIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy51c2VySWQyVXNlciA9IHsKICAgICAgICAuLi50aGlzLnVzZXJJZDJVc2VyLAogICAgICAgIC4uLnVzZXJJZDJVc2VySW5mbwogICAgICB9OwogICAgfSwKICAgIGdvdG86IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2gocGF0aCk7CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/audio-call","sourcesContent":["<template>\n  <div class=\"audio-call-section\">\n    <div\n      class=\"audio-call-section-header\"\n    >Welcome {{loginUserInfo && (loginUserInfo.name || loginUserInfo.userId)}}</div>\n    <div class=\"audio-call-section-title\">语音通话</div>\n    <search-user @callUser=\"handleCallUser\" @cancelCallUser=\"handleCancelCallUser\"></search-user>\n    <div :class=\"{ 'audio-conference': true, 'is-show': isShowAudioCall }\">\n      <div class=\"audio-conference-header\">语音通话区域</div>\n\n      <div class=\"audio-conference-list\">\n        <div\n          v-for=\"userId in meetingUserIdList\"\n          :key=\"`audio-${userId}`\"\n          :class=\"{'user-audio-container': true, 'is-me': userId === loginUserInfo.userId}\"\n        >\n          <div class=\"user-status\">\n            <div\n              :class=\"{'user-audio-status': true, 'is-mute': isUserMute(muteAudioUserIdList, userId)}\"\n            ></div>\n          </div>\n          <div class=\"audio-item-username\">{{userId2User[userId] && userId2User[userId].name}}</div>\n        </div>\n      </div>\n      <div class=\"audio-conference-action\">\n        <el-button\n          class=\"action-btn\"\n          type=\"success\"\n          @click=\"toggleAudio\"\n        >{{isAudioOn ? '关闭麦克风' : '打开麦克风'}}</el-button>\n\n        <el-button class=\"action-btn\" type=\"danger\" @click=\"handleHangup\">挂断</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\";\nimport SearchUser from \"../search-user\";\nimport { getUserDetailInfoByUserid } from \"../../service\";\nimport config from \"../../config\";\n\nexport default {\n  name: \"AudioCall\",\n  components: {\n    SearchUser\n  },\n  computed: {\n    ...mapState({\n      loginUserInfo: state => state.loginUserInfo,\n      callStatus: state => state.callStatus,\n      isInviter: state => state.isInviter,\n      meetingUserIdList: state => state.meetingUserIdList,\n      muteAudioUserIdList: state => state.muteAudioUserIdList\n    })\n  },\n  data() {\n    return {\n      isShowAudioCall: false,\n      isAudioOn: true,\n      userId2User: {}\n    };\n  },\n  mounted() {\n    if (this.callStatus === \"connected\" && !this.isInviter) {\n      this.startMeeting();\n      this.updateUserId2UserInfo(this.meetingUserIdList);\n    }\n  },\n  destroyed() {\n    this.$store.commit(\"updateMuteVideoUserIdList\", []);\n    this.$store.commit(\"updateMuteAudioUserIdList\", []);\n    if (this.callStatus === \"connected\") {\n      this.$trtcCalling.hangup();\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n    }\n  },\n  watch: {\n    callStatus: function(newStatus, oldStatus) {\n      // 建立通话连接\n      if (newStatus !== oldStatus && newStatus === \"connected\") {\n        this.startMeeting();\n        this.updateUserId2UserInfo(this.meetingUserIdList);\n      }\n    },\n    meetingUserIdList: function(newList, oldList) {\n      if (newList !== oldList || newList.length !== oldList.length) {\n        this.updateUserId2UserInfo(newList);\n      }\n    }\n  },\n  methods: {\n    handleCallUser: function({ param }) {\n      if (!param) {\n        this.$message.error(\"请输入拨叫号码\");\n        return;\n      }\n      this.$trtcCalling.call({\n        userID: param,\n        type: this.TrtcCalling.CALL_TYPE.AUDIO_CALL,\n        timeout: config.CallTimeout\n      });\n      this.$store.commit(\"userJoinMeeting\", this.loginUserInfo.userId);\n      this.$store.commit(\"updateCallStatus\", \"calling\");\n      this.$store.commit(\"updateIsInviter\", true);\n    },\n    handleCancelCallUser: function() {\n      this.$trtcCalling.hangup();\n      this.$store.commit(\"dissolveMeeting\");\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n    },\n    toggleAudio: function() {\n      this.isAudioOn = !this.isAudioOn;\n      this.$trtcCalling.setMicMute(!this.isAudioOn);\n      if (this.isAudioOn) {\n        const muteUserList = this.muteAudioUserIdList.filter(\n          userId => userId !== this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteAudioUserIdList\", muteUserList);\n      } else {\n        const muteUserList = this.muteAudioUserIdList.concat(\n          this.loginUserInfo.userId\n        );\n        this.$store.commit(\"updateMuteAudioUserIdList\", muteUserList);\n      }\n    },\n    handleHangup: function() {\n      this.$trtcCalling.hangup();\n      this.isShowVideoCall = false;\n      this.$store.commit(\"updateCallStatus\", \"idle\");\n      this.$router.push(\"/\");\n    },\n    isUserMute: function(muteUserList, userId) {\n      return muteUserList.indexOf(userId) !== -1;\n    },\n    startMeeting: function() {\n      this.isShowAudioCall = true;\n    },\n    updateUserId2UserInfo: async function(userIdList) {\n      let userId2UserInfo = {};\n      let loginUserId = this.loginUserInfo.userId;\n      for (let i = 0; i < userIdList.length; i++) {\n        const userId = userIdList[i];\n        const userInfo = await getUserDetailInfoByUserid(userId);\n        userId2UserInfo[userId] = userInfo;\n        if (loginUserId === userId) {\n          userId2UserInfo[userId].name += \"(me)\";\n        }\n      }\n      this.userId2User = {\n        ...this.userId2User,\n        ...userId2UserInfo\n      };\n    },\n    goto: function(path) {\n      this.$router.push(path);\n    }\n  }\n};\n</script>\n\n<style scoped>\n.audio-call-section {\n  padding-top: 50px;\n  width: 800px;\n  margin: 0 auto;\n}\n.audio-call-section-header {\n  font-size: 24px;\n}\n.audio-call-section-title {\n  margin-top: 30px;\n  font-size: 20px;\n}\n.audio-conference {\n  display: none;\n  margin-top: 20px;\n}\n.audio-conference.is-show {\n  display: block;\n}\n\n.audio-conference-list {\n  display: flex;\n  flex-direction: row;\n  margin-top: 10px;\n  justify-content: center;\n}\n\n.user-audio-container {\n  background-color: #333;\n  position: relative;\n  text-align: left;\n  width: 360px;\n  height: 240px;\n  margin-right: 10px;\n  background: black;\n}\n\n.audio-conference-action {\n  margin-top: 10px;\n}\n\n.user-audio-status {\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n  width: 22px;\n  height: 27px;\n  z-index: 10;\n  background-image: url(\"../../assets/mic-on.png\");\n  background-size: cover;\n}\n\n.audio-item-avatar-wrapper {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translateX(-50%) translateY(-50%);\n  width: 80px;\n  height: 80px;\n  z-index: 20;\n}\n\n.audio-item-avatar-wrapper img {\n  width: 80px;\n  height: 80px;\n}\n\n.user-audio-status.is-mute {\n  background-image: url(\"../../assets/mic-off.png\");\n}\n\n.audio-item-username {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  z-index: 10;\n  color: #ffffff;\n}\n@media screen and (max-width: 767px) {\n  .audio-call-section {\n    width: 100%;\n  }\n  .audio-conference-list {\n    padding: 0 10px;\n  }\n  .user-audio-container {\n    margin: 5px;\n    width: 180px;\n    height: 120px;\n  }\n}\n</style>\n"]}]}